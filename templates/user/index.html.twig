{% extends 'base.html.twig' %}

{% block title %}Gestion des utilisateurs - Mini Blog
{% endblock %}

{% block body %}
	<style>
		.admin-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 2rem;
			padding-bottom: 1rem;
			border-bottom: 3px solid #1a1a1a;
		}
		.admin-header h1 {
			font-size: 2rem;
			color: #1a1a1a;
			font-weight: 700;
		}
		.stats {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 1.5rem;
			margin-bottom: 2rem;
		}
		.stat-card {
			background: white;
			padding: 1.5rem;
			border: 1px solid #1a1a1a;
		}
		.stat-card h3 {
			font-size: 0.9rem;
			color: #666;
			margin-bottom: 0.5rem;
			text-transform: uppercase;
			font-weight: 600;
		}
		.stat-card .stat-value {
			font-size: 2rem;
			font-weight: bold;
			color: #1a1a1a;
		}
		.users-table {
			background: white;
			border: 2px solid #1a1a1a;
			overflow: hidden;
		}
		table {
			width: 100%;
			border-collapse: collapse;
		}
		thead {
			background: #1a1a1a;
			color: white;
		}
		thead th {
			padding: 1rem;
			text-align: left;
			font-weight: 600;
		}
		tbody tr {
			border-bottom: 1px solid #e0e0e0;
		}
		tbody tr:last-child {
			border-bottom: none;
		}
		tbody tr:hover {
			background: #f8f8f8;
		}
		tbody td {
			padding: 1rem;
			color: #333;
		}
		.user-info {
			display: flex;
			flex-direction: column;
			gap: 0.25rem;
		}
		.user-name {
			font-weight: 600;
			color: #1a1a1a;
		}
		.user-email {
			font-size: 0.9rem;
			color: #666;
		}
		.badge {
			display: inline-block;
			padding: 0.3rem 0.8rem;
			font-size: 0.85rem;
			font-weight: 600;
			margin-right: 0.3rem;
			border: 1px solid;
		}
		.badge-admin {
			background: #1a1a1a;
			color: white;
			border-color: #1a1a1a;
		}
		.badge-user {
			background: white;
			color: #1a1a1a;
			border-color: #1a1a1a;
		}
		.status-badge {
			display: inline-flex;
			align-items: center;
			gap: 0.4rem;
			padding: 0.4rem 0.8rem;
			font-size: 0.9rem;
			font-weight: 500;
			border: 1px solid;
		}
		.status-active {
			background: white;
			color: #1a1a1a;
			border-color: #1a1a1a;
		}
		.status-inactive {
			background: #f8f8f8;
			color: #666;
			border-color: #e0e0e0;
		}
		.btn-toggle {
			padding: 0.5rem 1rem;
			border: 1px solid #1a1a1a;
			font-size: 0.9rem;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.2s;
			background: white;
		}
		.btn-activate {
			color: #1a1a1a;
			border-color: #1a1a1a;
		}
		.btn-activate:hover {
			background: #1a1a1a;
			color: white;
		}
		.btn-deactivate {
			color: #666;
			border-color: #666;
		}
		.btn-deactivate:hover {
			background: #666;
			color: white;
		}
		.no-users {
			text-align: center;
			padding: 3rem;
			color: #666;
		}
	</style>

	<div class="admin-header">
		<h1>Gestion des utilisateurs</h1>
	</div>

	<div class="stats">
		<div class="stat-card">
			<h3>Total</h3>
			<div class="stat-value">{{ users|length }}</div>
		</div>
		<div class="stat-card">
			<h3>Actifs</h3>
			<div class="stat-value">{{ users|filter(u => u.isActive)|length }}</div>
		</div>
		<div class="stat-card">
			<h3>Désactivés</h3>
			<div class="stat-value">{{ users|filter(u => not u.isActive)|length }}</div>
		</div>
	</div>

	<div class="users-table">
		{% if users %}
			<table>
				<thead>
					<tr>
						<th>Utilisateur</th>
						<th>Rôles</th>
						<th>Statut</th>
						<th>Date d'inscription</th>
						<th>Action</th>
					</tr>
				</thead>
				<tbody>
					{% for user in users %}
						<tr>
							<td>
								<div class="user-info">
									<span class="user-name">{{ user.firstName }}
										{{ user.lastName }}</span>
									<span class="user-email">{{ user.email }}</span>
								</div>
							</td>
							<td>
								{% for role in user.roles %}
									{% if role == 'ROLE_ADMIN' %}
										<span class="badge badge-admin">Admin</span>
									{% elseif role == 'ROLE_USER' %}
										<span class="badge badge-user">User</span>
									{% else %}
										<span class="badge badge-user">{{ role }}</span>
									{% endif %}
								{% endfor %}
							</td>
							<td>
								{% if user.isActive %}
									<span class="status-badge status-active">
										Actif
									</span>
								{% else %}
									<span class="status-badge status-inactive">
										Désactivé
									</span>
								{% endif %}
							</td>
							<td>
								{{ user.createdAt ? user.createdAt|date('d/m/Y') : 'N/A' }}
							</td>
							<td>
								<form method="post" action="{{ path('app_user_toggle', {id: user.id}) }}" style="display: inline;">
									<button type="submit" class="btn-toggle {% if user.isActive %}btn-deactivate{% else %}btn-activate{% endif %}">
										{% if user.isActive %}
											Désactiver
										{% else %}
											Activer
										{% endif %}
									</button>
								</form>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		{% else %}
			<div class="no-users">
				<p>Aucun utilisateur enregistré.</p>
			</div>
		{% endif %}
	</div>
{% endblock %}
