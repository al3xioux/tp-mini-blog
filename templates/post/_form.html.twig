<style>
	.form-group {
		margin-bottom: 1.5rem;
	}
	.form-group label {
		display: block;
		margin-bottom: 0.5rem;
		color: #1a1a1a;
		font-weight: 600;
	}
	.form-control {
		width: 100%;
		padding: 0.75rem;
		border: 1px solid #1a1a1a;
		background: white;
		color: #1a1a1a;
		font-size: 1rem;
		font-family: inherit;
	}
	.form-control:focus {
		outline: none;
		background: #f8f8f8;
	}
	textarea.form-control {
		min-height: 300px;
		resize: vertical;
	}
	.btn-submit {
		width: 100%;
		padding: 1rem;
		background: #1a1a1a;
		color: white;
		border: 1px solid #1a1a1a;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
	}
	.btn-submit:hover {
		background: white;
		color: #1a1a1a;
	}
	.form-error {
		color: #666;
		font-size: 0.9rem;
		margin-top: 0.25rem;
	}
	.btn-add-category {
		display: inline-block;
		padding: 0.75rem 1rem;
		background: #4CAF50;
		color: white;
		text-decoration: none;
		font-size: 0.9rem;
		font-weight: 600;
		white-space: nowrap;
		border: 1px solid #4CAF50;
		text-align: center;
		transition: all 0.2s;
		cursor: pointer;
	}
	.btn-add-category:hover {
		background: white;
		color: #4CAF50;
	}

	/* Modal styles */
	.modal {
		display: none;
		position: fixed;
		z-index: 1000;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		overflow: auto;
		background-color: rgba(0, 0, 0, 0.5);
	}
	.modal.active {
		display: block;
	}
	.modal-content {
		background-color: white;
		margin: 5% auto;
		padding: 2rem;
		border: 2px solid #1a1a1a;
		width: 90%;
		max-width: 600px;
		position: relative;
	}
	.modal-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 1.5rem;
		padding-bottom: 1rem;
		border-bottom: 2px solid #1a1a1a;
	}
	.modal-header h2 {
		margin: 0;
		font-size: 1.5rem;
		color: #1a1a1a;
	}
	.close-modal {
		font-size: 2rem;
		font-weight: bold;
		color: #666;
		cursor: pointer;
		background: none;
		border: none;
		padding: 0;
		line-height: 1;
	}
	.close-modal:hover {
		color: #1a1a1a;
	}
	.modal-form-group {
		margin-bottom: 1.5rem;
	}
	.modal-form-group label {
		display: block;
		margin-bottom: 0.5rem;
		color: #1a1a1a;
		font-weight: 600;
	}
	.modal-form-group input,
	.modal-form-group textarea {
		width: 100%;
		padding: 0.75rem;
		border: 1px solid #1a1a1a;
		background: white;
		color: #1a1a1a;
		font-size: 1rem;
		font-family: inherit;
		box-sizing: border-box;
	}
	.modal-form-group textarea {
		min-height: 100px;
		resize: vertical;
	}
	.modal-form-group input:focus,
	.modal-form-group textarea:focus {
		outline: none;
		background: #f8f8f8;
	}
	.btn-modal-submit {
		width: 100%;
		padding: 1rem;
		background: #4CAF50;
		color: white;
		border: 1px solid #4CAF50;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
	}
	.btn-modal-submit:hover {
		background: white;
		color: #4CAF50;
	}
	.error-message {
		color: #d32f2f;
		font-size: 0.9rem;
		margin-top: 0.5rem;
	}
	.success-message {
		color: #4CAF50;
		font-size: 0.9rem;
		margin-top: 0.5rem;
	}
</style>

{{ form_start(form) }}
<div class="form-group">
	{{ form_label(form.title, 'Titre de l\'article') }}
        {{ form_widget(form.title, {'attr': {'class': 'form-control', 'placeholder': 'Titre de votre article'}}) }}
        {{ form_errors(form.title) }}
    </div>

    <div class="form-group">
        {{ form_label(form.content, 'Contenu') }}
        {{ form_widget(form.content, {'attr': {'class': 'form-control', 'placeholder': 'Contenu de votre article'}}) }}
        {{ form_errors(form.content) }}
    </div>

    {% if form.publishedAt is defined %}
        <div class="form-group">
            {{ form_label(form.publishedAt, 'Date de publication') }}
            {{ form_widget(form.publishedAt, {'attr': {'class': 'form-control'}}) }}
            {{ form_errors(form.publishedAt) }}
        </div>
    {% endif %}

    {% if form.picture is defined %}
        <div class="form-group">
            {{ form_label(form.picture, 'Image (URL)') }}
            {{ form_widget(form.picture, {'attr': {'class': 'form-control', 'placeholder': 'URL de l\'image'}}) }}
	{{ form_errors(form.picture) }}
</div>{% endif %}{% if form.author is defined %}
<div class="form-group">
	{{ form_label(form.author, 'Auteur') }}
	{{ form_widget(form.author, {'attr': {'class': 'form-control'}}) }}
	{{ form_errors(form.author) }}
</div>{% endif %}{% if form.category is defined %}
<div class="form-group">
	{{ form_label(form.category, 'Catégorie') }}
	<div style="display: flex; gap: 0.5rem; align-items: flex-start;">
		<div style="flex: 1;">
			{{ form_widget(form.category, {'attr': {'class': 'form-control', 'id': 'post_category'}}) }}
			{{ form_errors(form.category) }}
		</div>
		<button type="button" class="btn-add-category" id="openCategoryModal" title="Ajouter une nouvelle catégorie">
			➕ Nouvelle catégorie
		</button>
	</div>
</div>{% endif %}<button class="btn-submit" type="submit">{{ button_label|default('Enregistrer') }}</button>{{ form_end(form) }}<!-- Modal pour créer une catégorie --><div id="categoryModal" class="modal">
<div class="modal-content">
	<div class="modal-header">
		<h2>Créer une nouvelle catégorie</h2>
		<button class="close-modal" id="closeCategoryModal">&times;</button>
	</div>
	<form id="categoryForm">
		<div class="modal-form-group">
			<label for="category_name">Nom de la catégorie *</label>
			<input type="text" id="category_name" name="name" required maxlength="100" placeholder="Ex: Technologie">
		</div>
		<div class="modal-form-group">
			<label for="category_description">Description</label>
			<textarea id="category_description" name="description" placeholder="Description de la catégorie (optionnel)"></textarea>
		</div>
		<div id="modalMessage"></div>
		<button type="submit" class="btn-modal-submit">Créer la catégorie</button>
	</form>
</div></div><script>
// Gestion de la modal
const modal = document.getElementById('categoryModal');
const openBtn = document.getElementById('openCategoryModal');
const closeBtn = document.getElementById('closeCategoryModal');
const categoryForm = document.getElementById('categoryForm');
const categorySelect = document.getElementById('post_category');
const modalMessage = document.getElementById('modalMessage');

// Ouvrir la modal
openBtn.addEventListener('click', function () {
modal.classList.add('active');
});

// Fermer la modal
closeBtn.addEventListener('click', function () {
modal.classList.remove('active');
categoryForm.reset();
modalMessage.innerHTML = '';
});

// Fermer la modal en cliquant en dehors
window.addEventListener('click', function (event) {
if (event.target === modal) {
modal.classList.remove('active');
categoryForm.reset();
modalMessage.innerHTML = '';
}
});

// Soumettre le formulaire de catégorie
categoryForm.addEventListener('submit', function (e) {
e.preventDefault();

const formData = new FormData(categoryForm);
const data = {
name: formData.get('name'),
description: formData.get('description')
};

modalMessage.innerHTML = '<p style="color: #666;">Création en cours...</p>';

fetch('{{ path('app_category_create_ajax') }}', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify(data)
}).then(response => response.json()).then(data => {
if (data.success) { // Ajouter la nouvelle catégorie au select
const option = new Option(data.category.name, data.category.id, true, true);
categorySelect.add(option);

// Message de succès
modalMessage.innerHTML = '<p class="success-message">✓ Catégorie créée avec succès !</p>';

// Fermer la modal après 1.5 secondes
setTimeout(() => {
modal.classList.remove('active');
categoryForm.reset();
modalMessage.innerHTML = '';
}, 1500);
} else {
modalMessage.innerHTML = '<p class="error-message">Erreur : ' + (
data.message || 'Une erreur est survenue'
) + '</p>';
}
}).catch(error => {
modalMessage.innerHTML = '<p class="error-message">Erreur : Impossible de créer la catégorie</p>';
console.error('Error:', error);
});
});</script>
